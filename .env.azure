# ===================================================
# Analytics Microservice - Azure Configuration
# ===================================================
# Este archivo contiene la configuración para desplegar
# el microservicio en Azure con Event Hub
# ===================================================

# ===================================================
# Server Configuration
# ===================================================
SERVER_PORT=8080
SERVER_IP=0.0.0.0

# ===================================================
# Database Configuration (Azure PostgreSQL)
# ===================================================
# Reemplaza con tu servidor de Azure PostgreSQL
DB_HOST=YOUR-SERVER.postgres.database.azure.com
DB_PORT=5432
DB_USER=YOUR-USERNAME
DB_PASSWORD=YOUR-PASSWORD
DB_NAME=analytics_db
DB_SSLMODE=require

# ===================================================
# Azure Event Hub Configuration (Kafka Protocol)
# ===================================================

# Bootstrap Server (Event Hub Namespace Endpoint)
# Format: <namespace>.servicebus.windows.net:9093
# Reemplaza YOUR-NAMESPACE con tu namespace de Azure Event Hub
KAFKA_BOOTSTRAP_SERVERS=YOUR-NAMESPACE.servicebus.windows.net:9093

# Security Protocol (Always SASL_SSL for Azure Event Hub)
KAFKA_SECURITY_PROTOCOL=SASL_SSL

# SASL Mechanism (Always PLAIN for Azure Event Hub)
KAFKA_SASL_MECHANISM=PLAIN

# SASL Username (Always "$ConnectionString" literal for Azure Event Hub)
KAFKA_SASL_USERNAME=$ConnectionString

# Azure Event Hub Connection String
# Get from: Azure Portal → Event Hub Namespace → Shared access policies → RootManageSharedAccessKey
# Format: Endpoint=sb://YOUR-NAMESPACE.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=YOUR-KEY
AZURE_EVENTHUB_CONNECTION_STRING=Endpoint=sb://YOUR-NAMESPACE.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=YOUR-SHARED-ACCESS-KEY-HERE

# ===================================================
# Topics Configuration (Event Hub Names)
# ===================================================

# Topic for execution analytics events
# This Event Hub must exist in your Azure Event Hub Namespace
KAFKA_TOPIC=execution.analytics

# Topic for user registration events
# This Event Hub must exist in your Azure Event Hub Namespace
KAFKA_USER_REGISTRATION_TOPIC=iam.user.registered

# ===================================================
# Consumer Groups Configuration
# ===================================================

# Consumer group for execution analytics
# Create in Azure Portal: Event Hub → Consumer groups
# Or use default: $Default
KAFKA_GROUP_ID=analytics-consumer-group

# Consumer group for user registration analytics
KAFKA_USER_REGISTRATION_GROUP_ID=user-registration-analytics-group

# ===================================================
# Azure Event Hub Specific Settings
# ===================================================

# Request timeout in milliseconds
# Azure Event Hub requires higher timeouts (recommended: 60000)
KAFKA_REQUEST_TIMEOUT_MS=60000

# Session timeout in milliseconds
# Azure Event Hub requires higher timeouts (recommended: 60000)
KAFKA_SESSION_TIMEOUT_MS=60000

# Enable auto-commit of offsets
# Set to false if you want manual control
KAFKA_ENABLE_AUTO_COMMIT=true

# ===================================================
# Service Discovery Configuration (Azure Eureka)
# ===================================================
# Reemplaza con tu URL de Eureka en Azure
SERVICE_DISCOVERY_URL=https://YOUR-EUREKA-SERVER.azurecontainerapps.io/eureka/
SERVICE_NAME=analytics-service
SERVICE_DISCOVERY_ENABLED=true

# ===================================================
# IMPORTANT NOTES
# ===================================================
#
# 1. Event Hub Namespace:
#    - Make sure your Event Hub namespace is created in Azure Portal
#    - Format: <namespace>.servicebus.windows.net
#
# 2. Event Hubs (Topics):
#    - Create Event Hubs: "execution.analytics" and "iam.user.registered"
#    - Recommended partitions: 2-4 for low/medium load
#    - Message retention: 1-7 days
#
# 3. Connection String:
#    - Never commit this file with real credentials to Git
#    - Use Azure Key Vault in production
#    - Get from: Shared access policies → RootManageSharedAccessKey
#
# 4. Consumer Groups:
#    - Create custom consumer groups in Azure Portal if needed
#    - Default group "$Default" is available automatically
#
# 5. Security:
#    - In production, create separate policies with minimal permissions
#    - Use "Send" policy for producers
#    - Use "Listen" policy for consumers
#
# 6. Timeouts:
#    - Azure Event Hub requires higher timeouts than local Kafka
#    - Adjust based on your network latency
#    - Recommended minimum: 60000ms (60 seconds)
#
# 7. TLS:
#    - TLS 1.2+ is enforced by Azure Event Hub
#    - Certificate validation is enabled by default
#    - No additional TLS configuration needed
#
# ===================================================
